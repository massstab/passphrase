<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Passphrase Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      height: 100vh;
      align-items: center;
      flex-direction: column;
    }
    .container {
      background: #fff;
      max-width: 500px;
      width: 100%;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    .option-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      color: #555;
    }
    input[type="number"],
    input[type="text"],
    input[type="file"],
    select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    input[type="checkbox"] {
      margin-right: 5px;
    }
    button {
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      background-color: #007bff;
      color: #fff;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #0056b3;
    }
    #passphrase {
      background: #e9ecef;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
      text-align: center;
      font-size: 1.1em;
      word-break: break-word;
      margin-bottom: 20px;
    }
    .buttons {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    #error {
      color: red;
      font-size: 1em;
      margin-top: 10px;
    }
    #success {
      color: green;
      font-size: 1em;
      margin-top: 10px;
    }
    #clipboardWarning {
      font-weight: bold;
      color: red;
      display: none;
      transition: opacity 0.3s;
      margin-top: 10px;
    }
    @media (max-width: 600px) {
      .container {
        padding: 15px;
        max-width: 90%;
      }
      button {
        width: 48%;
        margin: 5px 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Passphrase Generator</h1>
    <div class="option-group">
      <label>Datei (wortliste.txt):</label>
      <input type="file" id="fileInput" accept=".txt" />
    </div>
    <div class="option-group">
      <label>Anzahl der Wörter:</label>
      <input type="number" id="numWords" value="4" min="1" max="12" />
    </div>
    <div class="option-group">
      <label>Groß-/Kleinschreibung:</label>
      <select id="caseStyle">
        <option value="lowercase">Nur Kleinbuchstaben</option>
        <option value="capitalized">Erste Groß, Rest klein</option>
        <option value="uppercase">Nur Großbuchstaben</option>
      </select>
    </div>
    <div class="option-group">
      <label>Sonderzeichen einfügen:</label>
      <input type="checkbox" id="specialChars" /> Ja
    </div>
    <div class="option-group">
      <label>Zahlen hinzufügen:</label>
      <input type="checkbox" id="includeNumbers" /> Ja
    </div>
    <div class="option-group">
      <label>Trennzeichen zwischen Wörtern:</label>
      <input type="text" id="delimiter" value="" placeholder="Standard: keine Trennung" />
    </div>
    <div class="buttons option-group">
      <button id="generateButton">Passphrase generieren</button>
      <button id="copyButton">In Zwischenablage kopieren</button>
    </div>
    <h3>Generierte Passphrase:</h3>
    <p id="passphrase"></p>
    <p id="error"></p>
    <p id="success"></p>
    <p id="clipboardWarning">⚠️ Die Passphrase könnte weiterhin in der Zwischenablage-Historie gespeichert sein!</p>
  </div>

  <script>
    let wordList = [];

    function processWordList(content) {
      return content.trim().toLowerCase().split(/\s+/).filter(word => word.length > 0);
    }

    function readFile(file) {
      const reader = new FileReader();
      reader.onload = function(event) {
        const content = event.target.result;
        wordList = processWordList(content);
        if (wordList.length === 0) {
          document.getElementById('error').textContent = "Fehler: Die Wortliste ist leer!";
        } else {
          document.getElementById('error').textContent = "";
          alert("Wortliste erfolgreich geladen!");
        }
      };
      reader.readAsText(file);
    }

    function applyCase(word, mode) {
      switch (mode) {
        case "lowercase":
          return word.toLowerCase();
        case "uppercase":
          return word.toUpperCase();
        default:
          return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
      }
    }

    function getRandomSpecialChar() {
      const specialChars = ['@', '#', '$', '%', '&', '*', '!', '?', '_', '+'];
      return specialChars[Math.floor(Math.random() * specialChars.length)];
    }

    function getRandomNumber() {
      return Math.floor(Math.random() * 10).toString();
    }

    function getEvenDistributionIndices(total, count) {
        if (count === 0) return [];
        if (count === 1) return [Math.floor(total / 2)];
        const step = (total - 1) / (count - 1);
        return Array.from({length: count}, (_, i) => Math.round(i * step));
    }

    function generatePassphrase() {
        const numWords = parseInt(document.getElementById('numWords').value, 10);
        const specialCharsEnabled = document.getElementById('specialChars').checked;
        const includeNumbers = document.getElementById('includeNumbers').checked;
        const delimiter = document.getElementById('delimiter').value;
        const caseStyle = document.getElementById('caseStyle').value;

        if (wordList.length === 0) {
            document.getElementById('error').textContent = "Fehler: Bitte lade zuerst eine Wortliste hoch!";
            return "";
        } else {
            document.getElementById('error').textContent = "";
        }

        let passphraseArray = [];
        let modificationIndices = [];
        
        // Berechne Gesamtmodifikationen (Sonderzeichen oder Zahlen)
        const modificationCount = Math.ceil(numWords * 0.5);
        
        if (specialCharsEnabled || includeNumbers) {
            modificationIndices = getEvenDistributionIndices(numWords, modificationCount);
        }

        for (let i = 0; i < numWords; i++) {
            let word = wordList[Math.floor(Math.random() * wordList.length)];
            word = applyCase(word, caseStyle);

            // Modifikationen hinzufügen (entweder Sonderzeichen oder Zahl oder beides)
            if (modificationIndices.includes(i)) {
                if (specialCharsEnabled) {
                    word += getRandomSpecialChar();
                }
                if (includeNumbers) {
                    word += getRandomNumber();
                }
            }
            
            passphraseArray.push(word);
        }
        
        return passphraseArray.join(delimiter);
    }

    function copyToClipboard(text) {
      const successElem = document.getElementById('success');
      
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(function() {
          // Erster Text
          successElem.innerHTML = "Passphrase erfolgreich in die Zwischenablage kopiert!<br><strong>Achtung!</strong> Die Passphrase befindet sich noch im Zwischenspeicher.";
          
          // Den Text nach 6 Sekunden verschwinden lassen
          setTimeout(function() {
            successElem.innerHTML = "";
          }, 6000); // Erfolgt nach 6 Sekunden
        }, function(err) {
          successElem.textContent = "Fehler beim Kopieren: " + err;
        });
      } else {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          const successful = document.execCommand('copy');
          const msg = successful ? 'Erfolgreich' : 'Fehler';
          successElem.innerHTML = msg + " in Zwischenablage kopiert!<br><strong>Achtung!</strong> Die Passphrase befindet sich noch im Zwischenspeicher.";
          
          // Den Text nach 6 Sekunden verschwinden lassen
          setTimeout(function() {
            successElem.innerHTML = "";
          }, 6000); // Erfolgt nach 6 Sekunden
        } catch (err) {
          successElem.textContent = "Fehler beim Kopieren: " + err;
        }
        document.body.removeChild(textArea);
      }
    }



    function showClipboardWarning() {
      const warning = document.getElementById("clipboardWarning");
      warning.style.display = "block";
      let visible = true;
      const interval = setInterval(() => {
        warning.style.opacity = visible ? "1" : "0";
        visible = !visible;
      }, 500);
      setTimeout(() => {
        clearInterval(interval);
        warning.style.display = "none";
        warning.style.opacity = "1";
      }, 5000);
    }

    document.getElementById('fileInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        readFile(file);
      }
    });

    document.getElementById('generateButton').addEventListener('click', function() {
      const passphrase = generatePassphrase();
      if (passphrase) {
        document.getElementById('passphrase').innerText = passphrase;
      }
    });

    document.getElementById('copyButton').addEventListener('click', function() {
      const passphrase = document.getElementById('passphrase').innerText;
      if (passphrase) {
        copyToClipboard(passphrase);
      } else {
        alert("Keine Passphrase zum Kopieren vorhanden!");
      }
    });
  </script>
</body>
</html>
